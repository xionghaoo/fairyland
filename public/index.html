<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
<!--      <meta http-equiv="Content-Security-Policy"-->
<!--            content="default-src 'self'; img-src https://*; child-src 'none';">-->
    <title><%= htmlWebpackPlugin.options.title %></title>
    <style>
      html,body {
          padding: 0 !important;
          margin: 0 !important;
          overflow: hidden;
      }
    </style>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <script async src="opencv.js" id="opencvjs"></script>
    <script>

        function onReady() {
            console.log("aruco onReady: ", cv);
            inputImage = new cv.Mat(height, width, cv.CV_8UC4);
            markerImage = new cv.Mat();
//dictionary = new cv.Dictionary(0);
//dictionary.markerSize = 3;
//dictionary.maxCorrectionBits = 1;
//dictionary.bytesList.delete();
//// dictionary.bytesList = cv.matFromArray(1, 2, cv.CV_8UC4, [197, 71,  81, 248, 226, 163, 31, 138]);
//dictionary.bytesList = cv.matFromArray(1, 2, cv.CV_8UC4, [177, 0, 135, 0, 70, 1, 112, 1]);
            let dictionary = new cv.Dictionary(cv.DICT_6X6_250);
            let parameter = new cv.DetectorParameters();

// parameter.adaptiveThreshWinSizeMin = 3,
            parameter.adaptiveThreshWinSizeMin = 23;
// parameter.adaptiveThreshWinSizeMax = 23,
            parameter.adaptiveThreshWinSizeMax = 23;
            parameter.adaptiveThreshWinSizeStep = 10,
                parameter.adaptiveThreshConstant = 7;
// parameter.minMarkerPerimeterRate = 0.03;
            parameter.minMarkerPerimeterRate = 0.1;
            parameter.maxMarkerPerimeterRate = 4;
            parameter.polygonalApproxAccuracyRate = 0.03;
            parameter.minCornerDistanceRate = 0.05;
            parameter.minDistanceToBorder = 3;
            parameter.minMarkerDistanceRate = 0.05;
            parameter.cornerRefinementMethod = cv.CORNER_REFINE_NONE;
            parameter.cornerRefinementWinSize = 5;
            parameter.cornerRefinementMaxIterations = 30;
            parameter.cornerRefinementMinAccuracy = 0.1;
            parameter.markerBorderBits = 1;
// parameter.perspectiveRemovePixelPerCell = 4;
            parameter.perspectiveRemovePixelPerCell = 2;
            parameter.perspectiveRemoveIgnoredMarginPerCell = 0.13;
            parameter.maxErroneousBitsInBorderRate = 0.35;
            parameter.minOtsuStdDev = 5.0;
            parameter.errorCorrectionRate = 0.6;

            markerIds = new cv.Mat();
            markerCorners  = new cv.MatVector();
            rvecs = new cv.Mat();
            tvecs = new cv.Mat();
            RgbImage = new cv.Mat();
            cameraMatrix = cv.matFromArray(3, 3, cv.CV_64F, [9.6635571716090658e+02, 0., 2.0679307818305685e+02, 0.,
                9.6635571716090658e+02, 2.9370020600555273e+02, 0., 0., 1.]);
            let distCoeffs = cv.matFromArray(5, 1, cv.CV_64F, [-1.5007354215536557e-03, 9.8722389825801837e-01,
                1.7188452542408809e-02, -2.6805958820424611e-02,-2.3313928379240205e+00]);
        }
        if (typeof cv !== 'undefined') {
            onReady();
        } else {
            document.getElementById("opencvjs").onload = onReady;
        }

    </script>
  </body>
</html>
